<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SNIPER BLAZE PRO â€” WEB</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b13; --panel:#111122; --glass:#15152a; --card:#151527; 
      --muted:#9aa3b2; --text:#eef2ff; --accent:#7b2cbf; --accent-2:#6ee7b7;
      --red:#ef4444; --black:#0f1115; --white:#f7f7f7; --stroke:#23243a;
      --ok:#22c55e; --bad:#ef4444; --chip:#1c1c35; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 800px at 5% -10%, #18182d 0%, transparent 60%), var(--bg);
      color:var(--text);font:400 14px/1.45 Inter,system-ui,Arial;letter-spacing:.2px;
    }
    .wrap{max-width:1200px;margin:20px auto;padding:0 16px}
    h1{font-size:18px;margin:0 0 16px 0;letter-spacing:.6px}
    .row{display:grid;gap:16px}
    .g2{grid-template-columns:1fr 2fr}
    .g3{grid-template-columns:2fr 1.2fr 1fr}
    @media (max-width:1024px){.g2,.g3{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--stroke); border-radius:14px; padding:14px; backdrop-filter:blur(6px)}
    .kpi{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .chip{background:var(--chip);border:1px solid var(--stroke); padding:6px 10px;border-radius:999px;font-weight:600}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);cursor:pointer;user-select:none}
    .pill.active{background:var(--accent);border-color:transparent}
    .btn{background:linear-gradient(180deg,#8b5cf6,#7c3aed); border:0; color:#fff; font-weight:700; padding:10px 14px; border-radius:10px; cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--stroke);color:var(--text)}
    .title{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px}
    .bar{height:10px;border-radius:999px;background:#20223a;overflow:hidden;border:1px solid var(--stroke)}
    .bar>span{display:block;height:100%}
    .flex{display:flex;gap:10px;align-items:center}
    .scroll {display:flex; gap:8px; overflow:auto; padding-bottom:6px}
    .ball{min-width:46px;height:46px;border-radius:10px;display:grid;place-items:center;font-weight:800;border:1px solid var(--stroke)}
    .ball.R{background:#e11d48}
    .ball.B{background:#0b0f14}
    .ball.W{background:#ffffff;color:#111;border-color:#ddd}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:14px}
    .big{display:grid;place-items:center;min-height:150px;border-radius:14px;border:1px dashed var(--stroke);text-align:center;padding:8px}
    .big.W{background:#f6f6f6;color:#111}
    .big.R{background:#ff2740}
    .big.B{background:#0f1117}
    .big>div{font-size:24px;font-weight:800}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--stroke);padding:10px 6px;text-align:left;vertical-align:top}
    th{font-size:12px;color:var(--muted);font-weight:600}
    .ok{color:var(--ok);font-weight:700}
    .bad{color:var(--bad);font-weight:700}
    .warn{color:var(--warn);font-weight:700}
    .hint{font-size:12px;color:var(--muted)}
    .grid-min{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    @media (max-width:720px){.grid-min{grid-template-columns:1fr}}
    input[type=number], select{
      background:#0e0e1a;color:var(--text);border:1px solid var(--stroke);
      padding:8px 10px;border-radius:10px;width:100%;
    }
    .mini{font-size:12px;opacity:.9}
    .nowrap{white-space:nowrap}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--stroke);background:var(--chip);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Header -->
    <div class="panel">
      <div class="title">
        <h1>SNIPER BLAZE PRO â€” WEB</h1>
        <div class="kpi">
          <div class="chip" id="state-pill">OFFLINE</div>
          <div class="pill active" id="mode-cores">CORES</div>
          <div class="pill" id="mode-branco">BRANCO</div>
          <button class="btn" id="btn-start">Iniciar</button>
          <button class="btn ghost" id="btn-stop">Parar</button>
        </div>
      </div>
    </div>

    <!-- Grid -->
    <div class="row g3" style="margin-top:14px">

      <!-- Esquerda: Controles + Chances + Cor Indicada -->
      <div class="panel">

        <!-- Controles de ConfluÃªncia -->
        <div class="card">
          <div class="title"><strong>ConfluÃªncia & Risco</strong><span class="hint mini">exige N estratÃ©gias batendo ao mesmo tempo</span></div>
          <div class="grid-min">
            <div>
              <div class="hint mini">MÃ­n. confluÃªncia â€” BRANCO</div>
              <input type="number" id="inp-conf-white" min="1" value="2">
            </div>
            <div>
              <div class="hint mini">MÃ­n. confluÃªncia â€” CORES</div>
              <input type="number" id="inp-conf-color" min="1" value="2">
            </div>
            <div>
              <div class="hint mini">SeleÃ§Ã£o de risco</div>
              <select id="sel-risk">
                <option value="conservador">Conservador (menor gales)</option>
                <option value="agressivo">Agressivo (maior gales)</option>
              </select>
            </div>
          </div>
          <div class="flex" style="justify-content:flex-end;margin-top:10px;gap:8px">
            <button class="btn ghost" id="btn-save-conf">Aplicar</button>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="title"><strong>Chances da rodada</strong></div>
          <div class="flex" style="justify-content:space-between">
            <span>âšª Branco</span><span id="w-val">6.7%</span>
          </div>
          <div class="bar"><span id="bar-w" style="width:6.7%;background:#e5e7eb"></span></div>

          <div class="flex" style="justify-content:space-between;margin-top:8px">
            <span>ðŸ”´ Vermelho</span><span id="r-val">46%</span>
          </div>
          <div class="bar"><span id="bar-r" style="width:46%;background:#ef4444"></span></div>

          <div class="flex" style="justify-content:space-between;margin-top:8px">
            <span>âš« Preto</span><span id="b-val">47%</span>
          </div>
          <div class="bar"><span id="bar-b" style="width:47%;background:#111827"></span></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="title"><strong>Alvo mais indicado</strong></div>
          <div id="pick" class="big B">
            <div>Preto â€¢ 50%</div>
            <div class="hint" id="pick-sub" style="margin-top:6px">â€”</div>
          </div>
          <div class="hint" id="pick-reasons" style="margin-top:8px">â€”</div>
        </div>

      </div>

      <!-- Centro: Ãšltimos giros -->
      <div class="panel">
        <div class="title">
          <strong>Ãšltimos giros</strong>
          <span class="muted" id="cooldowns">â€”</span>
        </div>
        <div id="rolls" class="scroll"></div>
      </div>

      <!-- Direita: HistÃ³rico -->
      <div class="panel">
        <div class="title"><strong>HistÃ³rico de Sinais</strong></div>
        <div class="card" style="max-height:420px;overflow:auto">
          <table>
            <thead><tr>
              <th>Hora</th><th>Modo</th><th>Alvo</th><th>RÃ³tulo</th><th>Estrategia</th><th>Conf.</th><th>Max Gales</th><th>Status</th><th>Gale</th><th>Saiu</th>
            </tr></thead>
            <tbody id="log"></tbody>
          </table>
        </div>
      </div>

    </div>

  </div>

  <script>
    const API = location.origin;
    const el = s => document.querySelector(s);

    // UI events: modo/ligar/desligar
    el('#mode-cores').onclick = async () => {
      el('#mode-cores').classList.add('active');
      el('#mode-branco').classList.remove('active');
      await fetch(API+'/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'CORES'})});
    };
    el('#mode-branco').onclick = async () => {
      el('#mode-branco').classList.add('active');
      el('#mode-cores').classList.remove('active');
      await fetch(API+'/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'BRANCO'})});
    };
    el('#btn-start').onclick = async () => {
      await fetch(API+'/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bot_on:true})});
    };
    el('#btn-stop').onclick = async () => {
      await fetch(API+'/control',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bot_on:false})});
    };

    // aplicar confluÃªncia/risco
    el('#btn-save-conf').onclick = async () => {
      const cw = parseInt(el('#inp-conf-white').value || '2', 10);
      const cc = parseInt(el('#inp-conf-color').value || '2', 10);
      const risk = el('#sel-risk').value;
      await fetch(API+'/control',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({confluence_white:cw, confluence_color:cc, risk})
      });
    };

    function ball(n){
      if(n===0) return `<div class="ball W">0</div>`;
      const c = (n>=1 && n<=7) ? 'R' : 'B';
      return `<div class="ball ${c}">${n}</div>`;
    }
    function setPick(tgt, pct, openTrade){
      const box = el('#pick');
      box.className = 'big '+tgt;
      const name = (tgt==='W'?'Branco':(tgt==='R'?'Vermelho':'Preto'));
      box.innerHTML = `<div>${name} â€¢ ${pct}%</div><div class="hint" id="pick-sub">â€”</div>`;
      // Complemento: mostra trade aberto (rÃ³tulo/estratÃ©gia)
      if(openTrade){
        const nm = {W:'Branco',R:'Vermelho',B:'Preto'}[openTrade.target||'B'];
        const galeTxt = openTrade.step>0 ? ` â€¢ GALE ${openTrade.step}` : '';
        el('#pick-sub').innerHTML = `<span class="tag">${nm}</span> â€¢ <span class="tag">${openTrade.strategy||'-'}</span> â€¢ mÃ¡x gales: <b>${openTrade.max_gales||0}</b>${galeTxt}`;
      }
    }
    function setBars(W,R,B){
      el('#w-val').textContent = `${W}%`;
      el('#r-val').textContent = `${R}%`;
      el('#b-val').textContent = `${B}%`;
      el('#bar-w').style.width = W+'%';
      el('#bar-r').style.width = R+'%';
      el('#bar-b').style.width = B+'%';
    }
    function setLog(rows){
      const mapName = v => v==='W'?'âšª':(v==='R'?'ðŸ”´':'âš«');
      el('#log').innerHTML = (rows||[]).map(r=>{
        const stClass = r.status==='WIN'?'ok':(r.status==='LOSS'?'bad':(r.status==='GALE'?'warn':''));
        return `
          <tr>
            <td class="nowrap">${r.ts||'-'}</td>
            <td>${r.mode||'-'}</td>
            <td>${mapName(r.target)}</td>
            <td>${r.label||'-'}</td>
            <td>${r.strategy||'-'}</td>
            <td>${r.confluence ?? '-'}</td>
            <td>${r.max_gales ?? '-'}</td>
            <td class="${stClass}">${(r.status||'-').toUpperCase()}</td>
            <td>${r.gale ?? '-'}</td>
            <td>${r.came ?? '-'}</td>
          </tr>
        `;
      }).join('');
    }

    async function tick(){
      try{
        const res = await fetch(API+'/state');
        const j = await res.json();

        // estado
        el('#state-pill').textContent = `${j.bot_on?'ONLINE':'OFFLINE'} â€¢ ${j.mode}`;

        // popular controles de confluÃªncia/risco
        if(j.confluence){
          el('#inp-conf-white').value = j.confluence.white_min ?? 2;
          el('#inp-conf-color').value = j.confluence.color_min ?? 2;
          el('#sel-risk').value = j.confluence.selecao_risco || 'conservador';
        }

        // roll chips
        el('#rolls').innerHTML = (j.last_50||[]).slice(-12).map(n=>ball(n)).join('');

        // probs
        setBars(j.probs.W, j.probs.R, j.probs.B);
        setPick(j.probs.rec.tgt, j.probs.rec.p, j.open_trade);

        // cooldowns
        el('#cooldowns').textContent = `cooldown â€¢ branco ${j.cooldowns.white}, cores ${j.cooldowns.color}`;

        // log
        setLog(j.signals || []);
      }catch(e){
        console.error(e);
        el('#state-pill').textContent = 'OFFLINE';
      }finally{
        setTimeout(tick, 900);
      }
    }
    tick();
  </script>
</body>
</html>
