<!-- templates/index.html -->
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SNIPER BLAZE PRO — WEB</title>
  <style>
    :root {
      --bg:#0f0d1a; --card:#151226; --ink:#cbd5e1; --muted:#8b8fa7;
      --green:#28c08a; --red:#ef4444; --accent:#7b2cbf; --yellow:#f59e0b;
      --whitechip:#f6f6f6; --blackchip:#0e0e10; --redchip:#ff2e2e;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#fff;font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial}
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px}
    h1{font-size:14px;letter-spacing:.08em;color:#e5e7eb;margin:0}
    .pill{padding:6px 10px;border-radius:10px;background:#1d1833;color:#c7c9d5;margin-right:8px}
    .wrap{display:grid;grid-template-columns:280px 1fr;gap:16px;padding:0 16px 24px}
    .card{background:var(--card);border:1px solid #251f3f;border-radius:14px;padding:16px}
    .title{font-weight:700;color:#e9e9f5;margin-bottom:8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:0;border-radius:10px;padding:8px 12px;background:#241b43;color:#e8e7f3;cursor:pointer}
    .btn:hover{background:#2b1f58}
    .btn-green{background:#173f33;color:#abf2d6}
    .btn-red{background:#43202a;color:#ffb2bb}
    .chips{display:grid;grid-template-columns:repeat(10,42px);gap:10px}
    .chip{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800}
    .c-red{background:var(--redchip)} .c-black{background:var(--blackchip)} .c-white{background:var(--whitechip);color:#111;border:1px solid #111}
    .bars .line{height:6px;border-radius:4px;background:#2b2641;margin:6px 0;position:relative}
    .bars .fill{position:absolute;left:0;top:0;bottom:0;border-radius:4px}
    .fill-w{background:#e2e8f0} .fill-r{background:#ef4444} .fill-b{background:#111827}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:10px 8px;border-bottom:1px solid #231d39;color:#d6d7e3;text-align:left}
    th{color:#9fa6c7;font-weight:600}
    .tag{padding:2px 8px;border-radius:999px;background:#231d39;color:#cbd5e1}
    .win{color:#abf2d6} .loss{color:#fca5a5}
  </style>
</head>
<body>
  <header>
    <h1>SNIPER BLAZE PRO — WEB</h1>
    <div class="row">
      <span class="pill" id="pill-mode">MODE: …</span>
      <span class="pill" id="pill-bot">BOT: OFF</span>
      <span class="pill muted" id="pill-src">src: —</span>
    </div>
  </header>

  <div class="wrap">
    <!-- Painel esquerdo -->
    <div class="card">
      <div class="title">Controle</div>
      <div class="row" style="margin-bottom:10px">
        <button class="btn" onclick="setMode('WHITE')">Modo Branco</button>
        <button class="btn" onclick="setMode('COLORS')">Modo Cores</button>
      </div>
      <div class="row" style="margin-bottom:10px">
        <button class="btn btn-green" onclick="bot('start')">Iniciar Bot</button>
        <button class="btn btn-red" onclick="bot('stop')">Parar Bot</button>
      </div>

      <div class="title" style="margin-top:12px">Chances da rodada</div>
      <div class="bars">
        <div class="muted">Branco <span id="pct-w" style="float:right">–</span></div>
        <div class="line"><div id="bar-w" class="fill fill-w" style="width:0%"></div></div>

        <div class="muted">Vermelho <span id="pct-r" style="float:right">–</span></div>
        <div class="line"><div id="bar-r" class="fill fill-r" style="width:0%"></div></div>

        <div class="muted">Preto <span id="pct-b" style="float:right">–</span></div>
        <div class="line"><div id="bar-b" class="fill fill-b" style="width:0%"></div></div>
      </div>

      <div class="title" style="margin-top:14px">Cor + indicada</div>
      <div id="box-indicada" class="row">
        <span class="tag">—</span>
      </div>
      <div class="muted" id="status" style="margin-top:10px">carregando…</div>
    </div>

    <!-- Painel direito -->
    <div class="card">
      <div class="title">Últimos giros</div>
      <div class="chips" id="chips"></div>

      <div class="title" style="margin-top:18px">Histórico de Sinais (somente UI)</div>
      <div style="overflow:auto;max-height:360px">
        <table>
          <thead>
          <tr><th>Hora</th><th>Modo</th><th>Alvo</th><th>Status</th><th>Saiu</th></tr>
          </thead>
          <tbody id="tbody">
            <!-- A UI não grava sinais real por design mínimo -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const $ = sel => document.querySelector(sel);

function paintChips(arr){
  const el = $("#chips");
  el.innerHTML = "";
  arr.forEach(n=>{
    let cls = (n===0) ? "c-white" : (n<=7 ? "c-red" : "c-black");
    const div = document.createElement("div");
    div.className = "chip "+cls;
    div.textContent = n;
    el.appendChild(div);
  });
}

function updBars(p){
  const w = Math.round(p.W*100), r = Math.round(p.R*100), b = Math.round(p.B*100);
  $("#bar-w").style.width = w+"%"; $("#pct-w").textContent = w+"%";
  $("#bar-r").style.width = r+"%"; $("#pct-r").textContent = r+"%";
  $("#bar-b").style.width = b+"%"; $("#pct-b").textContent = b+"%";

  const label = p.rec[0]==="W" ? "Branco" : (p.rec[0]==="R"?"Vermelho":"Preto");
  $("#box-indicada").innerHTML = `<span class="tag">${label} • ${Math.round(p.rec[1]*100)}%</span>`;
}

async function pull(){
  try{
    const res = await fetch("/state");
    const js = await res.json();
    $("#pill-mode").textContent = "MODE: "+js.mode;
    $("#pill-bot").textContent  = "BOT: "+(js.bot_active?"ON":"OFF");
    $("#pill-src").textContent  = "src: "+(js.src||"—");
    $("#status").textContent    = js.status || "ok";
    paintChips(js.last||[]);
    updBars(js.probs||{W:0,R:0,B:0,rec:["W",0]});
  }catch(e){
    $("#status").textContent = "erro: "+e;
  }
}

async function setMode(m){
  await fetch("/mode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:m})});
  pull();
}
async function bot(a){
  await fetch("/bot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:a})});
  pull();
}
setInterval(pull, 1000);
pull();
</script>
</body>
</html>
